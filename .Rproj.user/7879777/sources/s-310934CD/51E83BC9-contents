
require(dplyr)
require(reshape2)

crosstab2 <- function(data, varx, vary, categ){

  varx <- rlang::sym(varx)
  vary <- enquo(vary)

  table <-
    data %>%
    count(!! varx, !! vary) %>%
    group_by(!! vary) %>%
    mutate(`%` = round(n/sum(n, na.rm = TRUE) * 100, 2)) %>%
    filter(!! varx == categ) %>%
    select(- !! varx) %>%
    rename(vary = !! vary, N = n)

  table %>%
    mutate(Variable = quo_name(quo(!! varx))) %>%
    dcast(`VariÃ¡vel` ~ vary, value.var = "%")
}
